@prefix html: <http://www.w3.org/1999/xhtml#> .
@prefix http: <http://www.w3.org/2011/http#> .
@prefix list: <http://www.w3.org/2000/10/swap/list#> .
@prefix log: <http://www.w3.org/2000/10/swap/log#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix schema: <http://schema.org/> .
@prefix string: <http://www.w3.org/2000/10/swap/string#> .

# Server root shows HTML homepage
{
   ?request http:path "/" .
   ?site schema:name ?name ;
       schema:description ?desc .
}
=> 
{
   ?response a http:Response ;
       http:respondsTo ?request ;
       http:responseCode 200 ;
       http:contentType "text/html" ;
       http:body [
           a html:element ;
           html:tagName "html" ;
           html:children ( [
               a html:element ;
               html:tagName "head" ;
               html:children ( [
                   a html:element ;
                   html:tagName "title" ;
                   html:textContent ?name 
               ] [
                   a html:element ;
                   html:tagName "meta" ;
                   html:attributes ( [
                       a html:attribute ;
                       html:name "charset" ;
                       html:value "utf-8" 
                   ] ) 
               ] [
                   a html:element ;
                   html:tagName "meta" ;
                   html:attributes ( [
                       a html:attribute ;
                       html:name "viewport" ;
                       html:value "width=device-width, initial-scale=1" 
                   ] ) 
               ] ) 
           ] [
               a html:element ;
               html:tagName "body" ;
               html:children ( [
                   a html:element ;
                   html:tagName "p" ;
                   html:children ( [
                       a html:text ;
                       html:content ?desc 
                   ] ) 
               ] ) 
           ] ) 
       ] 
} .
{
   ?element a html:element ;
       html:tagName ?tagName ;
       html:children ?children .
   ?children html:outerHTML ?childrenOuterHTML .
}
=> 
{
   ( "<" ?tagName ">" ?childrenOuterHTML "</" ?tagName ">" ) string:concatenate ?outerHTML .
   ?element html:outerHTML ?outerHTML .
} .

# html:text
{
   ?text a html:text ;
       html:content ?content .
}
=> 
{
   ?text html:outerHTML ?content .
} .

# HTML string building
( ) html:outerHTML "" .
{
   ?list a rdf:List ;
       rdf:first ?first ;
       rdf:rest ?rest .
   ?first html:outerHTML ?firstOuterHTML .
   ?rest html:outerHTML ?restOuterHTML .
}
=> 
{
   ?list html:outerHTML ?html .
   ( ?firstOuterHTML ?restOuterHTML ) string:concatenate ?html .
} .
